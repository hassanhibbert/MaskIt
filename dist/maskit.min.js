"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Math.sign||(Math.sign=function(t){return t=+t,0===t||isNaN(t)?Number(t):t>0?1:-1});var Utils={getCursorPosition:function(t){var e=0,n=t.selectionStart;return n&&(n||0===n)&&(e=n),e},setCursorPosition:function(t,e){t.setSelectionRange&&(t.focus(),t.setSelectionRange(e,e))},getElementList:function(t){return"string"==typeof t?[].concat(_toConsumableArray(document.querySelectorAll(t))):"undefined"==typeof t||t instanceof Array?t:[t]},setListeners:function(t,e,n,i){if(t&&e&&n)for(var s=(i?"add":"remove")+"EventListener",r=0,o=t.length;r<o;r++)t[r][s](e,n,!1)},escapeRegExp:function(t){return"string"==typeof t?t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):t}},MaskIt=function(){function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,t),this.maskDefinitions={0:{pattern:/\d/},A:{pattern:/[a-zA-Z]/},Z:{pattern:/[a-zA-Z0-9]/}};var i={element:null,maskDefinitions:null,onInputHandler:null,onChangeHandler:null,onInvalidCharacter:null,onComplete:null};this.cursorBeforeState,this.events=[{type:"input",handler:this.onInputHandler.bind(this)},{type:"change",handler:this.onChangeHandler.bind(this)},{type:"keydown",handler:this.onKeyDownHandler.bind(this)}],this.options=Object.assign(i,n),this.options.maskDefinitions&&(this.maskDefinitions=Object.assign(this.maskDefinitions,this.options.maskDefinitions)),this.maskPatterns=[].concat(_toConsumableArray(e)),this.options.element&&(this.elements=Utils.getElementList(this.options.element),this.initializeEvents())}return _createClass(t,[{key:"initializeEvents",value:function(){var t=this;this.events.forEach(function(e){Utils.setListeners(t.elements,e.type,e.handler,!0)})}},{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){Utils.setListeners(t.elements,e.type,e.handler,!1)})}},{key:"isMaskComplete",value:function(t){return this.maskPatterns.length===t.length}},{key:"onKeyDownHandler",value:function(t){this.cursorBeforeState=Utils.getCursorPosition(t.target)}},{key:"onInputHandler",value:function(t){var e=this.maskInput(t.target);this.options.onInputHandler&&this.options.onInputHandler({output:e,event:t})}},{key:"onChangeHandler",value:function(t){if(this.options.onChangeHandler){var e=this.maskInput(t.target);this.options.onChangeHandler({output:e,event:t})}}},{key:"unmask",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=e.split(""),i=this.removeDuplicatesPatterns(this.maskPatterns),s=this.mapPatternToMaskDefinitions(i),r=n.filter(function(e){var n=s.some(function(t){return new RegExp(Utils.escapeRegExp(t)).test(e)});return t.options.onInvalidCharacter&&!n&&t.options.onInvalidCharacter({invalidCharacter:e}),n});return r.join("")}},{key:"removeDuplicatesPatterns",value:function(t){return t.reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[])}},{key:"getPatternsForMask",value:function(){var t=this;return this.maskPatterns.reduce(function(e,n){var i=t.maskDefinitions[n],s=i&&e.indexOf(i.pattern)<0;return s&&e.push(i.pattern),e},[])}},{key:"mapPatternToMaskDefinitions",value:function(t){var e=this;return t.map(function(t){var n=e.maskDefinitions[t];return n?n.pattern:t})}},{key:"calculateCursorPosition",value:function(t,e,n){var i=n-e,s=t+i,r=this.cursorBeforeState>t&&1===i||Math.sign(i)<0,o=s>1?s:t;return r?t:o}},{key:"mask",value:function t(){for(var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=this.mapPatternToMaskDefinitions(this.maskPatterns),i=[].concat(_toConsumableArray(this.unmask(e))),t=[],s=0;s<n.length;s+=1){var r=n[s],o=i[s],a=new RegExp(Utils.escapeRegExp(r),"g");if(a.test(o))t.push(o);else if("object"!==("undefined"==typeof r?"undefined":_typeof(r)))i.splice(s,0,r),t.push(r);else{if(!(t.length<n.length&&void 0!==i[s]))return t.join("");i.splice(s,1),s-=1}}var u=t.join("");return this.isMaskComplete(u)&&this.options.onComplete&&this.options.onComplete({complete:u}),u}},{key:"maskInput",value:function(t){var e=t,n=this.mask(e.value),i=Utils.getCursorPosition(e),s=e.value.length,r=n.length,o=this.calculateCursorPosition(i,s,r);return s?(e.value=n,Utils.setCursorPosition(e,o),n):""}}]),t}();